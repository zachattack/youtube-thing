<head>
  <meta http-equiv="Content-type" content="text/html; charset=utf-8">
  <title>index</title>
<script type="text/javascript" src="https://www.google.com/jsapi"></script>
  <script type="text/javascript" charset="utf-8">
    google.load("jquery", "1.7.1");
    google.load("jqueryui", "1.8.16");
  </script>
</head>
<body>
  <div id='controls'>
    <select id='category' class='control'>
      <option value=''></option>
    </select>
    <select id='limit' class='control'>
      <option value'10'>10</option>
      <option value'25'>25</option>
      <option value'50'>50</option>
      <option value'100'>100</option>
      <option value'250'>250</option>
      <option value'500'>500</option>
    </select>
  </div>
  <div id='output'></div>
</body>
<script type="text/javascript" charset="utf-8">
  $(function(){
    var design = "http://localhost:5984/youtube-sxsw/_design/by"
    var list = design + "/_list/html/category"
    var params = {
      reduce: false,
      include_docs: true,
    };
    var category = $('#category');
    
    var loadContent = function() {
      if(category.val() !== '') {
        params['key'] = '"'+category.val()+'"';
      }
      params['limit'] = $('#limit').val();
      $.ajax({
        url: list,
        data: params,
        dataType: 'html',
        success: function(response) {
          // console.log(response);
          $('#output').html(response);
        }
      });
    };
    
    var loadCategories = function() {
      $.ajax({
        url: design + "/_view/category",
        data: {group:true},
        dataType: 'json',
        success: function(response) {
          var key, value;
          for(i in response.rows) {
            key = response.rows[i].key;
            value = response.rows[i].value;
            category.append($('<option>').val(key).text(key + ' ('+value+')'))
          }
        }
      })
    }
    loadCategories();
    loadContent();
    
    $('.control').change(function(){
      loadContent();
    });
  })
</script>